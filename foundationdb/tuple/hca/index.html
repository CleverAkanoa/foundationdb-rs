<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `hca` mod in crate `foundationdb`."><meta name="keywords" content="rust, rustlang, rust-lang, hca"><title>foundationdb::tuple::hca - Rust</title><link rel="stylesheet" type="text/css" href="../../../normalize.css"><link rel="stylesheet" type="text/css" href="../../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../../dark.css"><link rel="stylesheet" type="text/css" href="../../../light.css" id="themeStyle"><script src="../../../storage.js"></script><noscript><link rel="stylesheet" href="../../../noscript.css"></noscript><link rel="shortcut icon" href="../../../favicon.ico"><style type="text/css">#crate-search{background-image:url("../../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../../foundationdb/index.html'><div class='logo-container'><img src='../../../rust-logo.png' alt='logo'></div></a><p class='location'>Module hca</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></div><p class='location'><a href='../../index.html'>foundationdb</a>::<wbr><a href='../index.html'>tuple</a></p><script>window.sidebarCurrent = {name: 'hca', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!"><img src="../../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices"></div></div><script src="../../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><a id="settings-menu" href="../../../settings.html"><img src="../../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class='fqn'><span class='out-of-band'><span id='render-detail'><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class='inner'>&#x2212;</span>]</a></span><a class='srclink' href='../../../src/foundationdb/tuple/hca.rs.html#9-220' title='goto source code'>[src]</a></span><span class='in-band'>Module <a href='../../index.html'>foundationdb</a>::<wbr><a href='../index.html'>tuple</a>::<wbr><a class="mod" href=''>hca</a></span></h1><div class='docblock'><p>The directory layer offers subspace indirection, where logical application subspaces are mapped to short, auto-generated key prefixes. This prefix assignment is done by the High Contention Allocator, which allows many clients to allocate short directory prefixes efficiently.</p>
<p>The allocation process works over candidate value windows. It uses two subspaces to operate, the &quot;counters&quot; subspace and &quot;recents&quot; subspace (derived from the subspace used to create the HCA).</p>
<p>&quot;counters&quot; contains a single key : &quot;counters : window_start&quot;, whose value is the number of allocations in the current window. &quot;window_start&quot; is an integer that marks the lower bound of values that can be assigned from the current window.
&quot;recents&quot; can contain many keys : &quot;recents : <candidate>&quot;, where each &quot;candidate&quot; is an integer that has been assigned to some client</p>
<p>Assignment has two stages that are executed in a loop until they both succeed.</p>
<ol>
<li>
<p>Find the current window. The client scans &quot;counters : *&quot; to get the current &quot;window_start&quot; and how many allocations have been made in the current window.
If the window is more than half-full (using pre-defined window sizes), the window is advanced: &quot;counters : *&quot; and &quot;recents : *&quot; are both cleared, and a new &quot;counters : window_start + window_size&quot; key is created with a value of 0. (1) is retried
If the window still has space, it moves to (2).</p>
</li>
<li>
<p>Find a candidate value inside that window. The client picks a candidate number between &quot;[window_start, window_start + window_size)&quot; and tries to set the key &quot;recents : <candidate>&quot;.
If the write succeeds, the candidate is returned as the allocated value. Success!
If the write fails because the window has been advanced, it repeats (1).
If the write fails because the value was already set, it repeats (2).</p>
</li>
</ol>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table><tr class='module-item'><td><a class="struct" href="struct.HighContentionAllocator.html" title='foundationdb::tuple::hca::HighContentionAllocator struct'>HighContentionAllocator</a></td><td class='docblock-short'><p>Represents a High Contention Allocator for a given subspace</p>
</td></tr></table><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table><tr class='module-item'><td><a class="enum" href="enum.HcaError.html" title='foundationdb::tuple::hca::HcaError enum'>HcaError</a></td><td class='docblock-short'></td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../../";window.currentCrate = "foundationdb";</script><script src="../../../aliases.js"></script><script src="../../../main.js"></script><script defer src="../../../search-index.js"></script></body></html>